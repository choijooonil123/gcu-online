<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¨ë¼ì¸ ê°•ì˜ì‹¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- PWA ì„¤ì • -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="GCU ê°•ì˜ì‹¤" />
  <link rel="icon" type="image/svg+xml" href="icons/icon.svg" />
  <link rel="apple-touch-icon" href="icons/icon.svg" />

  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans KR", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    /* ========== ë¡œê·¸ì¸ í™”ë©´ ========== */
    .login-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .login-overlay.hidden {
      display: none;
    }

    .login-container {
      background: #020617;
      border: 1px solid #1f2937;
      border-radius: 16px;
      padding: 32px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .login-header {
      text-align: center;
      margin-bottom: 28px;
    }

    .login-header h1 {
      font-size: 24px;
      margin: 0 0 8px 0;
      color: #f1f5f9;
    }

    .login-header p {
      font-size: 14px;
      color: #9ca3af;
      margin: 0;
    }

    .role-selector {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
    }

    .role-btn {
      flex: 1;
      padding: 16px 12px;
      border: 2px solid #374151;
      border-radius: 12px;
      background: transparent;
      color: #9ca3af;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .role-btn:hover {
      border-color: #4b5563;
      background: #1f2937;
    }

    .role-btn.active {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
      color: #60a5fa;
    }

    .role-btn.active.admin {
      border-color: #8b5cf6;
      background: rgba(139, 92, 246, 0.1);
      color: #a78bfa;
    }

    .role-btn .role-icon {
      font-size: 28px;
    }

    .role-btn .role-label {
      font-size: 13px;
      font-weight: 600;
    }

    .form-group.hidden {
      display: none;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 6px;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #374151;
      border-radius: 8px;
      background: #0f172a;
      color: #e5e7eb;
      font-size: 14px;
      transition: border-color 0.2s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .form-group input::placeholder {
      color: #6b7280;
    }

    .submit-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      margin-top: 8px;
    }

    .submit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }

    .submit-btn:active {
      transform: translateY(0);
    }

    .login-footer {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
      color: #6b7280;
    }

    /* ========== ë©”ì¸ ë ˆì´ì•„ì›ƒ ========== */
    .main-app {
      display: none;
      flex-direction: column;
      height: 100%;
    }

    .main-app.show {
      display: flex;
    }

    header {
      padding: 10px 16px;
      background: #020617;
      border-bottom: 1px solid #1f2937;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    header .title {
      font-size: 18px;
      font-weight: 600;
    }

    header .subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: #1f2937;
      border-radius: 8px;
      font-size: 13px;
    }

    .user-badge.professor {
      border: 1px solid #f59e0b;
      color: #fcd34d;
    }

    .user-badge.student {
      border: 1px solid #10b981;
      color: #6ee7b7;
    }

    .user-badge .badge-icon {
      font-size: 16px;
    }

    .logout-btn {
      padding: 6px 12px;
      border: 1px solid #ef4444;
      border-radius: 6px;
      background: transparent;
      color: #f87171;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .logout-btn:hover {
      background: rgba(239, 68, 68, 0.1);
    }

    main {
      flex: 1;
      display: flex;
      padding: 8px;
      height: calc(100% - 56px);
    }

    section {
      flex: 1;
      width: 100%;
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1f2937;
      padding: 10px;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .jitsi-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .jitsi-header {
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .room-name-display {
      font-weight: 500;
      color: #60a5fa;
    }

    .jitsi-frame {
      flex: 1;
      border: none;
      border-radius: 8px;
      background: black;
      width: 100%;
    }

    .small-note {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }

    @media (max-width: 900px) {
      .user-info {
        width: 100%;
        justify-content: space-between;
      }
    }

    /* ========== PWA ì„¤ì¹˜ ë²„íŠ¼ ========== */
    .install-btn {
      display: none;
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      border: 2px dashed #10b981;
      border-radius: 10px;
      background: rgba(16, 185, 129, 0.1);
      color: #6ee7b7;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .install-btn:hover {
      background: rgba(16, 185, 129, 0.2);
      border-style: solid;
    }

    .install-btn.show {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .install-guide {
      display: none;
      margin-top: 12px;
      padding: 12px;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid #3b82f6;
      border-radius: 8px;
      font-size: 12px;
      color: #93c5fd;
      text-align: center;
    }

    .install-guide.show {
      display: block;
    }

    /* ========== êµìˆ˜ ì»¨íŠ¸ë¡¤ ë°” ========== */
    .professor-controls {
      display: none;
      gap: 8px;
      padding: 10px;
      background: #020617;
      border-bottom: 1px solid #1f2937;
      flex-wrap: wrap;
    }

    .professor-controls.show {
      display: flex;
    }

    .ctrl-btn {
      padding: 8px 16px;
      border: 1px solid #374151;
      border-radius: 8px;
      background: #1f2937;
      color: #e5e7eb;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ctrl-btn:hover {
      background: #374151;
    }

    .ctrl-btn.primary {
      background: #2563eb;
      border-color: #2563eb;
      color: white;
    }

    .ctrl-btn.primary:hover {
      background: #1d4ed8;
    }

    .ctrl-btn.danger {
      background: #dc2626;
      border-color: #dc2626;
      color: white;
    }

    .ctrl-btn.danger:hover {
      background: #b91c1c;
    }

    .ctrl-btn.success {
      background: #16a34a;
      border-color: #16a34a;
      color: white;
    }

    .ctrl-btn.success:hover {
      background: #15803d;
    }

    .ctrl-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .class-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #0f172a;
      border-radius: 8px;
      font-size: 13px;
      margin-left: auto;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #6b7280;
    }

    .status-dot.live {
      background: #22c55e;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ========== ëª¨ë‹¬ ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: #0f172a;
      border: 1px solid #1f2937;
      border-radius: 16px;
      width: 100%;
      max-width: 800px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid #1f2937;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 18px;
      color: #f1f5f9;
    }

    .modal-close {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    .modal-close:hover {
      color: #f1f5f9;
    }

    .modal-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid #1f2937;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    /* ========== ìˆ˜ê°•ìƒ ê´€ë¦¬ ========== */
    .student-input-row {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }

    .student-input-row input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #374151;
      border-radius: 8px;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
    }

    .student-input-row input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .student-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .student-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      background: #1f2937;
      border-radius: 8px;
    }

    .student-item .student-name {
      font-size: 14px;
    }

    .student-item .delete-btn {
      background: none;
      border: none;
      color: #ef4444;
      cursor: pointer;
      font-size: 18px;
      padding: 0;
    }

    .student-item .delete-btn:hover {
      color: #f87171;
    }

    .empty-list {
      text-align: center;
      color: #6b7280;
      padding: 30px;
      font-size: 14px;
    }

    /* ========== ì¶œì„ë¶€ í…Œì´ë¸” ========== */
    .week-selector {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }

    .week-selector label {
      font-size: 14px;
      color: #9ca3af;
    }

    .week-selector select {
      padding: 8px 12px;
      border: 1px solid #374151;
      border-radius: 8px;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
    }

    .attendance-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .attendance-table th,
    .attendance-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #1f2937;
    }

    .attendance-table th {
      background: #020617;
      color: #9ca3af;
      font-weight: 600;
    }

    .attendance-table tr:hover {
      background: rgba(59, 130, 246, 0.05);
    }

    .attendance-status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .attendance-status.present {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
    }

    .attendance-status.late {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    .attendance-status.early-leave {
      background: rgba(249, 115, 22, 0.2);
      color: #fb923c;
    }

    .attendance-status.absent {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
    }

    .attendance-status.pending {
      background: rgba(107, 114, 128, 0.2);
      color: #9ca3af;
    }

    .time-info {
      font-size: 11px;
      color: #6b7280;
    }

    .attendance-summary {
      display: flex;
      gap: 16px;
      margin-top: 16px;
      padding: 12px;
      background: #020617;
      border-radius: 8px;
      flex-wrap: wrap;
    }

    .summary-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }

    .summary-item .count {
      font-weight: 700;
    }

    /* ========== ìš´ì˜ì ë°°ì§€ ========== */
    .user-badge.admin {
      border: 1px solid #8b5cf6;
      color: #c4b5fd;
    }

    /* ========== ìš´ì˜ì ì»¨íŠ¸ë¡¤ ë°” ========== */
    .admin-controls {
      display: none;
      gap: 8px;
      padding: 10px;
      background: #020617;
      border-bottom: 1px solid #1f2937;
      flex-wrap: wrap;
    }

    .admin-controls.show {
      display: flex;
    }

    /* ========== ê°•ì˜ ê´€ë¦¬ ========== */
    .course-card {
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .course-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .course-card-title {
      font-size: 16px;
      font-weight: 600;
      color: #f1f5f9;
    }

    .course-card-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 13px;
      color: #9ca3af;
    }

    .course-card-info span {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .course-card-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .admin-form-group {
      margin-bottom: 16px;
    }

    .admin-form-group label {
      display: block;
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 6px;
      font-weight: 500;
    }

    .admin-form-group input,
    .admin-form-group textarea {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #374151;
      border-radius: 8px;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
    }

    .admin-form-group textarea {
      min-height: 120px;
      resize: vertical;
      font-family: inherit;
    }

    .admin-form-group input:focus,
    .admin-form-group textarea:focus {
      outline: none;
      border-color: #8b5cf6;
    }

    .admin-form-group .help-text {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }

    .no-courses {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }
  </style>
</head>
<body>

  <!-- ========== ë¡œê·¸ì¸ í™”ë©´ ========== -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-container">
      <div class="login-header">
        <h1>ğŸ“ ì˜¨ë¼ì¸ ê°•ì˜ì‹¤</h1>
      </div>

      <!-- ì—­í•  ì„ íƒ -->
      <div class="role-selector">
        <button type="button" class="role-btn" id="btnAdmin" onclick="selectRole('admin')">
          <span class="role-icon">âš™ï¸</span>
          <span class="role-label">ìš´ì˜</span>
        </button>
        <button type="button" class="role-btn active" id="btnProfessor" onclick="selectRole('professor')">
          <span class="role-icon">ğŸ‘¨â€ğŸ«</span>
          <span class="role-label">êµìˆ˜</span>
        </button>
        <button type="button" class="role-btn" id="btnStudent" onclick="selectRole('student')">
          <span class="role-icon">ğŸ‘¨â€ğŸ“</span>
          <span class="role-label">í•™ìƒ</span>
        </button>
      </div>

      <!-- ì…ë ¥ í¼ -->
      <form id="loginForm" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="inputName" id="labelName">ì´ë¦„ *</label>
          <input type="text" id="inputName" placeholder="í™ê¸¸ë™" required />
        </div>

        <div class="form-group hidden" id="groupEmployeeId">
          <label for="inputEmployeeId" id="labelEmployeeId">ì‚¬ë²ˆ *</label>
          <input type="password" id="inputEmployeeId" placeholder="ì‚¬ë²ˆ ì…ë ¥" />
        </div>

        <div class="form-group" id="groupCourse">
          <label for="inputCourse">ê°•ì˜ëª… *</label>
          <input type="text" id="inputCourse" placeholder="ì˜ˆ: ì„±ê²½ê°œë¡ " required />
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
          ğŸš€ ê°•ì˜ì‹¤ ì…ì¥
        </button>
      </form>

      <!-- PWA ì„¤ì¹˜ ë²„íŠ¼ -->
      <button type="button" class="install-btn" id="installBtn" onclick="installApp()">
        ğŸ“² í™ˆ í™”ë©´ì— ì•± ì¶”ê°€
      </button>
      
      <!-- iOS ì„¤ì¹˜ ê°€ì´ë“œ -->
      <div class="install-guide" id="iosGuide">
        ğŸ“± iPhone/iPad: í•˜ë‹¨ì˜ <b>ê³µìœ  ë²„íŠ¼</b> â†’ <b>"í™ˆ í™”ë©´ì— ì¶”ê°€"</b>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”
      </div>

      <div class="login-footer">
        ê¹€ì²œëŒ€í•™êµ ìƒë‹´ì‹¬ë¦¬í•™ê³¼
      </div>
    </div>
  </div>

  <!-- ========== ë©”ì¸ ì•± ========== -->
  <div class="main-app" id="mainApp">
    <header>
      <div class="header-left">
        <div class="title">ê¹€ì²œëŒ€í•™êµ ìƒë‹´ì‹¬ë¦¬í•™ê³¼ ê°•ì˜ì‹¤</div>
      </div>

      <div class="user-info">
        <div class="user-badge" id="userBadge">
          <span class="badge-icon" id="badgeIcon">ğŸ‘¨â€ğŸ«</span>
          <span id="badgeText">CHOI JUNIL êµìˆ˜</span>
        </div>
        <button class="logout-btn" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </header>

    <!-- ìš´ì˜ì ì „ìš© ì»¨íŠ¸ë¡¤ ë°” -->
    <div class="admin-controls" id="adminControls">
      <button class="ctrl-btn primary" onclick="openCourseModal()">
        ğŸ“š ê°•ì˜ ê´€ë¦¬
      </button>
      <button class="ctrl-btn" onclick="openAllAttendanceModal()">
        ğŸ“‹ ì „ì²´ ì¶œì„ë¶€
      </button>
    </div>

    <!-- êµìˆ˜ ì „ìš© ì»¨íŠ¸ë¡¤ ë°” -->
    <div class="professor-controls" id="professorControls">
      <button class="ctrl-btn primary" id="btnStartClass" onclick="startClass()">
        â–¶ï¸ ìˆ˜ì—…ì‹œì‘
      </button>
      <button class="ctrl-btn danger" id="btnEndClass" onclick="endClass()" disabled>
        â¹ï¸ ìˆ˜ì—…ì¢…ë£Œ
      </button>
      <button class="ctrl-btn" onclick="openAttendanceModal()">
        ğŸ“‹ ì¶œì„ë¶€
      </button>
      <div class="class-status">
        <span class="status-dot" id="statusDot"></span>
        <span id="classStatusText">ìˆ˜ì—… ëŒ€ê¸°ì¤‘</span>
      </div>
    </div>

    <main>
      <!-- Jitsi ì˜ìƒì˜ì—­ -->
      <section>
        <div class="jitsi-wrapper">
          <div class="jitsi-header">
            <div>
              í˜„ì¬ ê°•ì˜ëª…: <span class="room-name-display" id="roomNameDisplay">-</span>
            </div>
            <div class="small-note">
              ì²˜ìŒ ì ‘ì† ì‹œ ë¸Œë¼ìš°ì €ê°€ ì¹´ë©”ë¼/ë§ˆì´í¬ ê¶Œí•œì„ ìš”ì²­í•˜ë©´ <b>í—ˆìš©</b>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
            </div>
          </div>

          <!-- Jitsi IFrame -->
          <iframe
            id="jitsiFrame"
            class="jitsi-frame"
            allow="camera; microphone; fullscreen; display-capture"
            src=""
          ></iframe>
        </div>
      </section>
    </main>
  </div>

  <!-- ========== ìˆ˜ê°•ìƒ ê´€ë¦¬ ëª¨ë‹¬ ========== -->
  <div class="modal-overlay" id="studentModal">
    <div class="modal">
      <div class="modal-header">
        <h2>ğŸ‘¥ ìˆ˜ê°•ìƒ ê´€ë¦¬</h2>
        <button class="modal-close" onclick="closeStudentModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="student-input-row">
          <input type="text" id="newStudentName" placeholder="ìˆ˜ê°•ìƒ ì´ë¦„ ì…ë ¥" onkeypress="handleStudentKeypress(event)" />
          <button class="ctrl-btn primary" onclick="addStudent()">ì¶”ê°€</button>
        </div>
        <div class="student-list" id="studentList">
          <div class="empty-list">ë“±ë¡ëœ ìˆ˜ê°•ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="ctrl-btn" onclick="closeStudentModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ========== ì¶œì„ë¶€ ëª¨ë‹¬ ========== -->
  <div class="modal-overlay" id="attendanceModal">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h2>ğŸ“‹ ì¶œì„ë¶€</h2>
        <button class="modal-close" onclick="closeAttendanceModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="week-selector">
          <label>ì£¼ì°¨ ì„ íƒ:</label>
          <select id="weekSelect" onchange="renderAttendanceTable()">
            <option value="1">1ì£¼ì°¨</option>
            <option value="2">2ì£¼ì°¨</option>
            <option value="3">3ì£¼ì°¨</option>
            <option value="4">4ì£¼ì°¨</option>
            <option value="5">5ì£¼ì°¨</option>
            <option value="6">6ì£¼ì°¨</option>
            <option value="7">7ì£¼ì°¨</option>
            <option value="8">8ì£¼ì°¨</option>
            <option value="9">9ì£¼ì°¨</option>
            <option value="10">10ì£¼ì°¨</option>
            <option value="11">11ì£¼ì°¨</option>
            <option value="12">12ì£¼ì°¨</option>
            <option value="13">13ì£¼ì°¨</option>
            <option value="14">14ì£¼ì°¨</option>
            <option value="15">15ì£¼ì°¨</option>
            <option value="16">16ì£¼ì°¨</option>
          </select>
          <button class="ctrl-btn" onclick="exportAttendance()">ğŸ“¥ ë‚´ë³´ë‚´ê¸°</button>
        </div>
        <table class="attendance-table">
          <thead>
            <tr>
              <th>ë²ˆí˜¸</th>
              <th>ì´ë¦„</th>
              <th>ì…ì¥ì‹œê°„</th>
              <th>í‡´ì¥ì‹œê°„</th>
              <th>ì¶œì„ìƒíƒœ</th>
            </tr>
          </thead>
          <tbody id="attendanceTableBody">
          </tbody>
        </table>
        <div class="attendance-summary" id="attendanceSummary">
        </div>
      </div>
      <div class="modal-footer">
        <button class="ctrl-btn" onclick="closeAttendanceModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ========== ê°•ì˜ ê´€ë¦¬ ëª¨ë‹¬ (ìš´ì˜ììš©) ========== -->
  <div class="modal-overlay" id="courseModal">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h2>ğŸ“š ê°•ì˜ ê´€ë¦¬</h2>
        <button class="modal-close" onclick="closeCourseModal()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- ê°•ì˜ ì¶”ê°€ í¼ -->
        <div style="background:#1e293b;padding:16px;border-radius:12px;margin-bottom:20px;">
          <h3 style="margin:0 0 16px 0;font-size:15px;color:#f1f5f9;">â• ìƒˆ ê°•ì˜ ë“±ë¡</h3>
          <div class="admin-form-group">
            <label>ê°•ì˜ëª… *</label>
            <input type="text" id="newCourseName" placeholder="ì˜ˆ: ì„±ê²½ê°œë¡ " />
          </div>
          <div class="admin-form-group">
            <label>ë‹´ë‹¹êµìˆ˜ëª… *</label>
            <input type="text" id="newProfessorName" placeholder="ì˜ˆ: í™ê¸¸ë™" />
          </div>
          <div class="admin-form-group">
            <label>ìˆ˜ê°•ìƒ ëª…ë‹¨</label>
            <textarea id="newStudentList" placeholder="í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥&#10;ì˜ˆ:&#10;ê¹€ì² ìˆ˜&#10;ì´ì˜í¬&#10;ë°•ë¯¼ìˆ˜"></textarea>
            <div class="help-text">í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥í•´ì£¼ì„¸ìš”</div>
          </div>
          <button class="ctrl-btn success" onclick="addCourse()" style="width:100%;">ê°•ì˜ ë“±ë¡</button>
        </div>

        <!-- ë“±ë¡ëœ ê°•ì˜ ëª©ë¡ -->
        <h3 style="margin:0 0 12px 0;font-size:15px;color:#9ca3af;">ğŸ“‹ ë“±ë¡ëœ ê°•ì˜ ëª©ë¡</h3>
        <div id="courseList">
          <div class="no-courses">ë“±ë¡ëœ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="ctrl-btn" onclick="closeCourseModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ========== ê°•ì˜ ìˆ˜ì • ëª¨ë‹¬ ========== -->
  <div class="modal-overlay" id="editCourseModal">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h2>âœï¸ ê°•ì˜ ìˆ˜ì •</h2>
        <button class="modal-close" onclick="closeEditCourseModal()">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editCourseId" />
        <div class="admin-form-group">
          <label>ê°•ì˜ëª… *</label>
          <input type="text" id="editCourseName" />
        </div>
        <div class="admin-form-group">
          <label>ë‹´ë‹¹êµìˆ˜ëª… *</label>
          <input type="text" id="editProfessorName" />
        </div>
        <div class="admin-form-group">
          <label>ìˆ˜ê°•ìƒ ëª…ë‹¨</label>
          <textarea id="editStudentList"></textarea>
          <div class="help-text">í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥í•´ì£¼ì„¸ìš”</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="ctrl-btn" onclick="closeEditCourseModal()">ì·¨ì†Œ</button>
        <button class="ctrl-btn primary" onclick="saveCourseEdit()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <script>
    // ========== ìš´ì˜ì ì¸ì¦ ì •ë³´ ==========
    const ADMIN_CREDENTIALS = {
      name: 'ìµœì¤€ì¼',
      employeeId: '19930007'
    };

    // í˜„ì¬ ì‚¬ìš©ì ì •ë³´
    let currentUser = {
      role: 'professor',  // 'admin', 'professor', 'student'
      name: '',
      course: ''
    };

    // ê°•ì˜ ë°ì´í„° (ìš´ì˜ìê°€ ê´€ë¦¬)
    let courseData = [];  // { id, name, professor, students: [] }

    // DOM ìš”ì†Œ
    const loginOverlay = document.getElementById('loginOverlay');
    const mainApp = document.getElementById('mainApp');
    const btnAdmin = document.getElementById('btnAdmin');
    const btnProfessor = document.getElementById('btnProfessor');
    const btnStudent = document.getElementById('btnStudent');

    // ê°•ì˜ ë°ì´í„° ë¡œë“œ
    function loadCourseData() {
      const saved = localStorage.getItem('gcu_courses');
      if (saved) {
        courseData = JSON.parse(saved);
      }
    }

    // ê°•ì˜ ë°ì´í„° ì €ì¥
    function saveCourseData() {
      localStorage.setItem('gcu_courses', JSON.stringify(courseData));
    }

    // ì´ˆê¸°í™” ì‹œ ë°ì´í„° ë¡œë“œ
    loadCourseData();

    // ì—­í•  ì„ íƒ
    function selectRole(role) {
      currentUser.role = role;

      // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
      btnAdmin.classList.remove('active', 'admin');
      btnProfessor.classList.remove('active');
      btnStudent.classList.remove('active');

      // í¼ ìš”ì†Œ
      const groupEmployeeId = document.getElementById('groupEmployeeId');
      const groupCourse = document.getElementById('groupCourse');
      const labelEmployeeId = document.getElementById('labelEmployeeId');
      const inputEmployeeId = document.getElementById('inputEmployeeId');
      const inputCourse = document.getElementById('inputCourse');
      const submitBtn = document.getElementById('submitBtn');

      if (role === 'admin') {
        btnAdmin.classList.add('active', 'admin');
        groupEmployeeId.classList.remove('hidden');
        groupCourse.classList.add('hidden');
        labelEmployeeId.textContent = 'ì‚¬ë²ˆ *';
        inputEmployeeId.placeholder = 'ì‚¬ë²ˆ ì…ë ¥';
        inputEmployeeId.required = true;
        inputCourse.required = false;
        submitBtn.textContent = 'âš™ï¸ ìš´ì˜ ì‹œì‘';
      } else if (role === 'professor') {
        btnProfessor.classList.add('active');
        groupEmployeeId.classList.add('hidden');
        groupCourse.classList.remove('hidden');
        inputEmployeeId.required = false;
        inputCourse.required = true;
        submitBtn.textContent = 'ğŸš€ ê°•ì˜ì‹¤ ì…ì¥';
      } else {
        btnStudent.classList.add('active');
        groupEmployeeId.classList.add('hidden');
        groupCourse.classList.remove('hidden');
        inputEmployeeId.required = false;
        inputCourse.required = true;
        submitBtn.textContent = 'ğŸš€ ê°•ì˜ì‹¤ ì…ì¥';
      }
    }

    // ë¡œê·¸ì¸ ì²˜ë¦¬
    function handleLogin(e) {
      e.preventDefault();

      const name = document.getElementById('inputName').value.trim();
      const employeeId = document.getElementById('inputEmployeeId').value.trim();
      const course = document.getElementById('inputCourse').value.trim();

      // ìš´ì˜ì ë¡œê·¸ì¸
      if (currentUser.role === 'admin') {
        if (name !== ADMIN_CREDENTIALS.name || employeeId !== ADMIN_CREDENTIALS.employeeId) {
          alert('ìš´ì˜ì ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì´ë¦„ê³¼ ì‚¬ë²ˆì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
          return;
        }
        currentUser.name = name;
        currentUser.course = '';
        
        loginOverlay.classList.add('hidden');
        mainApp.classList.add('show');
        updateMainUI();
        return;
      }

      // êµìˆ˜/í•™ìƒ ë¡œê·¸ì¸
      if (!name || !course) {
        alert('ì´ë¦„ê³¼ ê°•ì˜ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      // ê°•ì˜ ì¡´ì¬ í™•ì¸
      const courseInfo = courseData.find(c => c.name === course);
      if (!courseInfo) {
        alert(`"${course}" ê°•ì˜ê°€ ë“±ë¡ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.\nìš´ì˜ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.`);
        return;
      }

      // êµìˆ˜ ê²€ì¦
      if (currentUser.role === 'professor') {
        if (courseInfo.professor !== name) {
          alert(`"${course}" ê°•ì˜ì˜ ë‹´ë‹¹êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤.\në“±ë¡ëœ ë‹´ë‹¹êµìˆ˜: ${courseInfo.professor}`);
          return;
        }
      }

      // í•™ìƒ ê²€ì¦
      if (currentUser.role === 'student') {
        if (!courseInfo.students.includes(name)) {
          alert(`"${course}" ê°•ì˜ì˜ ìˆ˜ê°•ìƒ ëª…ë‹¨ì— "${name}"ì´(ê°€) ì—†ìŠµë‹ˆë‹¤.\nìš´ì˜ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.`);
          return;
        }
      }

      currentUser.name = name;
      currentUser.course = course;

      // ë¡œê·¸ì¸ í™”ë©´ ìˆ¨ê¸°ê³  ë©”ì¸ ì•± í‘œì‹œ
      loginOverlay.classList.add('hidden');
      mainApp.classList.add('show');

      // UI ì—…ë°ì´íŠ¸
      updateMainUI();

      // Jitsi ê°•ì˜ì‹¤ ë¡œë“œ (ìš´ì˜ìê°€ ì•„ë‹Œ ê²½ìš°)
      if (currentUser.role !== 'admin') {
        loadRoom(course);
      }
    }

    // ë©”ì¸ UI ì—…ë°ì´íŠ¸
    function updateMainUI() {
      const userBadge = document.getElementById('userBadge');
      const badgeIcon = document.getElementById('badgeIcon');
      const badgeText = document.getElementById('badgeText');
      const adminControls = document.getElementById('adminControls');
      const professorControls = document.getElementById('professorControls');

      // ëª¨ë“  ì»¨íŠ¸ë¡¤ ìˆ¨ê¸°ê¸°
      adminControls.classList.remove('show');
      professorControls.classList.remove('show');

      if (currentUser.role === 'admin') {
        userBadge.className = 'user-badge admin';
        badgeIcon.textContent = 'âš™ï¸';
        badgeText.textContent = `${currentUser.name} ìš´ì˜ì`;
        adminControls.classList.add('show');
        // ìš´ì˜ìëŠ” Jitsi í”„ë ˆì„ ìˆ¨ê¸°ê¸°
        document.getElementById('jitsiFrame').style.display = 'none';
        document.querySelector('.jitsi-header').innerHTML = '<div style="text-align:center;padding:40px;color:#9ca3af;">ìš´ì˜ì ëª¨ë“œ - ìƒë‹¨ ë©”ë‰´ì—ì„œ ê°•ì˜ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</div>';
      } else if (currentUser.role === 'professor') {
        userBadge.className = 'user-badge professor';
        badgeIcon.textContent = 'ğŸ‘¨â€ğŸ«';
        badgeText.textContent = `${currentUser.name} êµìˆ˜`;
        professorControls.classList.add('show');
        document.getElementById('jitsiFrame').style.display = '';
        loadAttendanceData();
        updateClassUI();
      } else {
        userBadge.className = 'user-badge student';
        badgeIcon.textContent = 'ğŸ‘¨â€ğŸ“';
        badgeText.textContent = `${currentUser.name} í•™ìƒ`;
        document.getElementById('jitsiFrame').style.display = '';
        checkStudentAttendance();
      }
    }

    // ë¡œê·¸ì•„ì›ƒ
    function handleLogout() {
      const message = currentUser.role === 'admin' ? 'ìš´ì˜ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?' : 'ê°•ì˜ì‹¤ì—ì„œ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?';
      if (confirm(message)) {
        // Jitsi í”„ë ˆì„ ì´ˆê¸°í™”
        document.getElementById('jitsiFrame').src = '';
        document.getElementById('jitsiFrame').style.display = '';

        // í¼ ì´ˆê¸°í™”
        document.getElementById('loginForm').reset();
        selectRole('professor');

        // í™”ë©´ ì „í™˜
        mainApp.classList.remove('show');
        loginOverlay.classList.remove('hidden');

        // ì‚¬ìš©ì ì •ë³´ ì´ˆê¸°í™”
        currentUser = {
          role: 'professor',
          name: '',
          course: ''
        };

        // Jitsi í—¤ë” ë³µì›
        document.querySelector('.jitsi-header').innerHTML = `
          <div>
            í˜„ì¬ ê°•ì˜ëª…: <span class="room-name-display" id="roomNameDisplay">-</span>
          </div>
          <div class="small-note">
            ì²˜ìŒ ì ‘ì† ì‹œ ë¸Œë¼ìš°ì €ê°€ ì¹´ë©”ë¼/ë§ˆì´í¬ ê¶Œí•œì„ ìš”ì²­í•˜ë©´ <b>í—ˆìš©</b>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
          </div>
        `;
      }
    }

    // ========== ê°•ì˜ ê´€ë¦¬ (ìš´ì˜ììš©) ==========
    
    function openCourseModal() {
      document.getElementById('courseModal').classList.add('show');
      renderCourseList();
    }

    function closeCourseModal() {
      document.getElementById('courseModal').classList.remove('show');
    }

    function addCourse() {
      const name = document.getElementById('newCourseName').value.trim();
      const professor = document.getElementById('newProfessorName').value.trim();
      const studentText = document.getElementById('newStudentList').value.trim();

      if (!name || !professor) {
        alert('ê°•ì˜ëª…ê³¼ ë‹´ë‹¹êµìˆ˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      // ì¤‘ë³µ í™•ì¸
      if (courseData.find(c => c.name === name)) {
        alert('ì´ë¯¸ ë“±ë¡ëœ ê°•ì˜ëª…ì…ë‹ˆë‹¤.');
        return;
      }

      // ìˆ˜ê°•ìƒ íŒŒì‹±
      const students = studentText ? studentText.split('\n').map(s => s.trim()).filter(s => s) : [];

      const newCourse = {
        id: Date.now().toString(),
        name,
        professor,
        students
      };

      courseData.push(newCourse);
      saveCourseData();

      // ì¶œì„ ë°ì´í„°ë„ ì´ˆê¸°í™”
      const attendanceKey = `attendance_${name}`;
      if (!localStorage.getItem(attendanceKey)) {
        localStorage.setItem(attendanceKey, JSON.stringify({
          students: students,
          classStartTime: null,
          classEndTime: null,
          isClassActive: false,
          currentWeek: 1,
          records: {}
        }));
      }

      // í¼ ì´ˆê¸°í™”
      document.getElementById('newCourseName').value = '';
      document.getElementById('newProfessorName').value = '';
      document.getElementById('newStudentList').value = '';

      renderCourseList();
      alert(`"${name}" ê°•ì˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    function renderCourseList() {
      const container = document.getElementById('courseList');

      if (courseData.length === 0) {
        container.innerHTML = '<div class="no-courses">ë“±ë¡ëœ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      container.innerHTML = courseData.map(course => `
        <div class="course-card">
          <div class="course-card-header">
            <span class="course-card-title">ğŸ“– ${course.name}</span>
          </div>
          <div class="course-card-info">
            <span>ğŸ‘¨â€ğŸ« ë‹´ë‹¹êµìˆ˜: <strong>${course.professor}</strong></span>
            <span>ğŸ‘¥ ìˆ˜ê°•ìƒ: <strong>${course.students.length}ëª…</strong></span>
          </div>
          <div class="course-card-actions">
            <button class="ctrl-btn" onclick="editCourse('${course.id}')">âœï¸ ìˆ˜ì •</button>
            <button class="ctrl-btn danger" onclick="deleteCourse('${course.id}')">ğŸ—‘ï¸ ì‚­ì œ</button>
          </div>
        </div>
      `).join('');
    }

    function editCourse(courseId) {
      const course = courseData.find(c => c.id === courseId);
      if (!course) return;

      document.getElementById('editCourseId').value = courseId;
      document.getElementById('editCourseName').value = course.name;
      document.getElementById('editProfessorName').value = course.professor;
      document.getElementById('editStudentList').value = course.students.join('\n');

      document.getElementById('editCourseModal').classList.add('show');
    }

    function closeEditCourseModal() {
      document.getElementById('editCourseModal').classList.remove('show');
    }

    function saveCourseEdit() {
      const courseId = document.getElementById('editCourseId').value;
      const name = document.getElementById('editCourseName').value.trim();
      const professor = document.getElementById('editProfessorName').value.trim();
      const studentText = document.getElementById('editStudentList').value.trim();

      if (!name || !professor) {
        alert('ê°•ì˜ëª…ê³¼ ë‹´ë‹¹êµìˆ˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const courseIndex = courseData.findIndex(c => c.id === courseId);
      if (courseIndex === -1) return;

      const oldName = courseData[courseIndex].name;
      const students = studentText ? studentText.split('\n').map(s => s.trim()).filter(s => s) : [];

      courseData[courseIndex] = {
        ...courseData[courseIndex],
        name,
        professor,
        students
      };

      saveCourseData();

      // ì¶œì„ ë°ì´í„° ì—…ë°ì´íŠ¸
      const attendanceKey = `attendance_${name}`;
      const oldAttendanceKey = `attendance_${oldName}`;
      
      // ê°•ì˜ëª…ì´ ë³€ê²½ëœ ê²½ìš° ì¶œì„ ë°ì´í„° í‚¤ë„ ë³€ê²½
      if (oldName !== name) {
        const oldData = localStorage.getItem(oldAttendanceKey);
        if (oldData) {
          localStorage.setItem(attendanceKey, oldData);
          localStorage.removeItem(oldAttendanceKey);
        }
      }

      // ìˆ˜ê°•ìƒ ëª©ë¡ ì—…ë°ì´íŠ¸
      const attendanceData = localStorage.getItem(attendanceKey);
      if (attendanceData) {
        const data = JSON.parse(attendanceData);
        data.students = students;
        localStorage.setItem(attendanceKey, JSON.stringify(data));
      }

      closeEditCourseModal();
      renderCourseList();
      alert('ê°•ì˜ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function deleteCourse(courseId) {
      const course = courseData.find(c => c.id === courseId);
      if (!course) return;

      if (!confirm(`"${course.name}" ê°•ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì¶œì„ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) return;

      // ì¶œì„ ë°ì´í„° ì‚­ì œ
      localStorage.removeItem(`attendance_${course.name}`);

      courseData = courseData.filter(c => c.id !== courseId);
      saveCourseData();
      renderCourseList();
      alert('ê°•ì˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function openAllAttendanceModal() {
      alert('ì „ì²´ ì¶œì„ë¶€ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    }

    // Jitsi URL ìƒì„±
    function buildJitsiUrl(roomName, displayName) {
      const cleanRoom = roomName.trim().replace(/\s+/g, '-');
      const encodedRoom = encodeURIComponent(cleanRoom);
      const encodedName = encodeURIComponent(displayName);
      
      // ê´‘ê³  ì—†ëŠ” ë¬´ë£Œ Jitsi ì„œë²„ ì‚¬ìš©
      return `https://meet.ffmuc.net/${encodedRoom}#userInfo.displayName="${encodedName}"`;
    }

    // ê°•ì˜ì‹¤ ë¡œë”©
    function loadRoom(roomName) {
      // êµìˆ˜: [êµìˆ˜] ì„±ëª…, í•™ìƒ: [í•™ìƒ] ì„±ëª…
      const displayName = currentUser.role === 'professor' 
        ? `[êµìˆ˜] ${currentUser.name}` 
        : `[í•™ìƒ] ${currentUser.name}`;
      
      const url = buildJitsiUrl(roomName, displayName);
      document.getElementById('jitsiFrame').src = url;
      document.getElementById('roomNameDisplay').textContent = roomName;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', () => {
      selectRole('professor');
    });

    // ========== ì¶œì„ ê´€ë¦¬ ì‹œìŠ¤í…œ ==========
    
    // ì¶œì„ ë°ì´í„° êµ¬ì¡°
    let attendanceData = {
      students: [],        // ìˆ˜ê°•ìƒ ëª©ë¡
      classStartTime: null, // ìˆ˜ì—… ì‹œì‘ ì‹œê°„
      classEndTime: null,   // ìˆ˜ì—… ì¢…ë£Œ ì‹œê°„
      isClassActive: false, // ìˆ˜ì—… ì§„í–‰ ì¤‘ ì—¬ë¶€
      currentWeek: 1,       // í˜„ì¬ ì£¼ì°¨
      records: {}           // ì£¼ì°¨ë³„ ì¶œì„ ê¸°ë¡ { week: { studentName: { joinTime, leaveTime, status } } }
    };

    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤ ìƒì„± (ê°•ì˜ëª… ê¸°ë°˜)
    function getStorageKey() {
      return `attendance_${currentUser.course}`;
    }

    // ë°ì´í„° ì €ì¥
    function saveAttendanceData() {
      localStorage.setItem(getStorageKey(), JSON.stringify(attendanceData));
    }

    // ë°ì´í„° ë¡œë“œ
    function loadAttendanceData() {
      const saved = localStorage.getItem(getStorageKey());
      if (saved) {
        attendanceData = JSON.parse(saved);
        // ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜
        if (attendanceData.classStartTime) {
          attendanceData.classStartTime = new Date(attendanceData.classStartTime);
        }
        if (attendanceData.classEndTime) {
          attendanceData.classEndTime = new Date(attendanceData.classEndTime);
        }
      }
      
      // courseDataì—ì„œ ìˆ˜ê°•ìƒ ëª©ë¡ ë™ê¸°í™”
      const courseInfo = courseData.find(c => c.name === currentUser.course);
      if (courseInfo) {
        attendanceData.students = courseInfo.students;
        saveAttendanceData();
      }
    }

    // ========== ìˆ˜ê°•ìƒ ê´€ë¦¬ ==========
    
    function openStudentModal() {
      document.getElementById('studentModal').classList.add('show');
      renderStudentList();
    }

    function closeStudentModal() {
      document.getElementById('studentModal').classList.remove('show');
    }

    function handleStudentKeypress(e) {
      if (e.key === 'Enter') {
        addStudent();
      }
    }

    function addStudent() {
      const input = document.getElementById('newStudentName');
      const name = input.value.trim();
      
      if (!name) {
        alert('ìˆ˜ê°•ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (attendanceData.students.includes(name)) {
        alert('ì´ë¯¸ ë“±ë¡ëœ ìˆ˜ê°•ìƒì…ë‹ˆë‹¤.');
        return;
      }
      
      attendanceData.students.push(name);
      saveAttendanceData();
      renderStudentList();
      input.value = '';
      input.focus();
    }

    function removeStudent(name) {
      if (confirm(`"${name}" ìˆ˜ê°•ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        attendanceData.students = attendanceData.students.filter(s => s !== name);
        saveAttendanceData();
        renderStudentList();
      }
    }

    function renderStudentList() {
      const container = document.getElementById('studentList');
      
      if (attendanceData.students.length === 0) {
        container.innerHTML = '<div class="empty-list">ë“±ë¡ëœ ìˆ˜ê°•ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      
      container.innerHTML = attendanceData.students.map((name, index) => `
        <div class="student-item">
          <span class="student-name">${index + 1}. ${name}</span>
          <button class="delete-btn" onclick="removeStudent('${name}')">&times;</button>
        </div>
      `).join('');
    }

    // ========== ìˆ˜ì—… ì‹œì‘/ì¢…ë£Œ ==========
    
    function startClass() {
      if (attendanceData.students.length === 0) {
        alert('ìˆ˜ê°•ìƒì´ ë“±ë¡ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.\nìš´ì˜ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const week = prompt('ëª‡ ì£¼ì°¨ ìˆ˜ì—…ì¸ê°€ìš”? (1-16)', attendanceData.currentWeek);
      if (!week) return;
      
      const weekNum = parseInt(week);
      if (isNaN(weekNum) || weekNum < 1 || weekNum > 16) {
        alert('1-16 ì‚¬ì´ì˜ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      attendanceData.currentWeek = weekNum;
      attendanceData.classStartTime = new Date();
      attendanceData.classEndTime = null;
      attendanceData.isClassActive = true;
      
      // í•´ë‹¹ ì£¼ì°¨ ì¶œì„ ê¸°ë¡ ì´ˆê¸°í™”
      if (!attendanceData.records[weekNum]) {
        attendanceData.records[weekNum] = {};
      }
      
      // ëª¨ë“  í•™ìƒ ê²°ì„ìœ¼ë¡œ ì´ˆê¸°í™”
      attendanceData.students.forEach(name => {
        if (!attendanceData.records[weekNum][name]) {
          attendanceData.records[weekNum][name] = {
            joinTime: null,
            leaveTime: null,
            status: 'absent'
          };
        }
      });
      
      saveAttendanceData();
      updateClassUI();
      
      alert(`${weekNum}ì£¼ì°¨ ìˆ˜ì—…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!\nì‹œì‘ ì‹œê°„: ${formatTime(attendanceData.classStartTime)}`);
    }

    function endClass() {
      if (!confirm('ìˆ˜ì—…ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      attendanceData.classEndTime = new Date();
      attendanceData.isClassActive = false;
      
      // ì¶œì„ ìƒíƒœ ìµœì¢… ê³„ì‚°
      calculateFinalAttendance();
      
      saveAttendanceData();
      updateClassUI();
      
      // ì¶œì„ ê²°ê³¼ í‘œì‹œ
      openAttendanceModal();
      alert(`ìˆ˜ì—…ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nì¢…ë£Œ ì‹œê°„: ${formatTime(attendanceData.classEndTime)}`);
    }

    function calculateFinalAttendance() {
      const week = attendanceData.currentWeek;
      const records = attendanceData.records[week];
      const startTime = attendanceData.classStartTime;
      const endTime = attendanceData.classEndTime;
      const lateThreshold = 15 * 60 * 1000; // 15ë¶„ (ë°€ë¦¬ì´ˆ)
      
      attendanceData.students.forEach(name => {
        const record = records[name];
        if (!record) return;
        
        if (!record.joinTime) {
          // ì…ì¥ ê¸°ë¡ ì—†ìŒ = ê²°ì„
          record.status = 'absent';
        } else {
          const joinTime = new Date(record.joinTime);
          const leaveTime = record.leaveTime ? new Date(record.leaveTime) : endTime;
          const joinDelay = joinTime - startTime;
          
          if (leaveTime < endTime) {
            // ìˆ˜ì—… ì¢…ë£Œ ì „ì— ë‚˜ê° = ì¡°í‡´
            record.status = 'early-leave';
          } else if (joinDelay > lateThreshold) {
            // 15ë¶„ ì´í›„ ì…ì¥ = ì§€ê° (í•˜ì§€ë§Œ 15ë¶„ ì´í›„ë„ ì°¸ì—¬í–ˆìœ¼ë©´ ì§€ê° ì²˜ë¦¬)
            record.status = 'late';
          } else if (joinDelay > 0 && joinDelay <= lateThreshold) {
            // ìˆ˜ì—… ì‹œì‘ í›„ 15ë¶„ ì´ë‚´ ì…ì¥ = ì§€ê°
            record.status = 'late';
          } else {
            // ì •ìƒ ì¶œì„
            record.status = 'present';
          }
        }
      });
      
      saveAttendanceData();
    }

    function updateClassUI() {
      const btnStart = document.getElementById('btnStartClass');
      const btnEnd = document.getElementById('btnEndClass');
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('classStatusText');
      
      if (attendanceData.isClassActive) {
        btnStart.disabled = true;
        btnEnd.disabled = false;
        statusDot.classList.add('live');
        statusText.textContent = `${attendanceData.currentWeek}ì£¼ì°¨ ìˆ˜ì—… ì§„í–‰ì¤‘`;
      } else {
        btnStart.disabled = false;
        btnEnd.disabled = true;
        statusDot.classList.remove('live');
        statusText.textContent = 'ìˆ˜ì—… ëŒ€ê¸°ì¤‘';
      }
    }

    // ========== í•™ìƒ ì…ì¥/í‡´ì¥ ê¸°ë¡ ==========
    
    function recordStudentJoin(studentName) {
      if (!attendanceData.isClassActive) return;
      
      const week = attendanceData.currentWeek;
      if (!attendanceData.records[week]) {
        attendanceData.records[week] = {};
      }
      
      if (!attendanceData.records[week][studentName]) {
        attendanceData.records[week][studentName] = {
          joinTime: null,
          leaveTime: null,
          status: 'absent'
        };
      }
      
      // ì²« ì…ì¥ ì‹œê°„ë§Œ ê¸°ë¡
      if (!attendanceData.records[week][studentName].joinTime) {
        attendanceData.records[week][studentName].joinTime = new Date();
      }
      
      saveAttendanceData();
    }

    function recordStudentLeave(studentName) {
      if (!attendanceData.isClassActive) return;
      
      const week = attendanceData.currentWeek;
      if (attendanceData.records[week] && attendanceData.records[week][studentName]) {
        attendanceData.records[week][studentName].leaveTime = new Date();
        saveAttendanceData();
      }
    }

    // ========== ì¶œì„ë¶€ í‘œì‹œ ==========
    
    function openAttendanceModal() {
      document.getElementById('attendanceModal').classList.add('show');
      document.getElementById('weekSelect').value = attendanceData.currentWeek;
      renderAttendanceTable();
    }

    function closeAttendanceModal() {
      document.getElementById('attendanceModal').classList.remove('show');
    }

    function renderAttendanceTable() {
      const week = parseInt(document.getElementById('weekSelect').value);
      const tbody = document.getElementById('attendanceTableBody');
      const records = attendanceData.records[week] || {};
      
      if (attendanceData.students.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#6b7280;padding:30px;">ë“±ë¡ëœ ìˆ˜ê°•ìƒì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        document.getElementById('attendanceSummary').innerHTML = '';
        return;
      }
      
      let presentCount = 0, lateCount = 0, earlyLeaveCount = 0, absentCount = 0;
      
      tbody.innerHTML = attendanceData.students.map((name, index) => {
        const record = records[name] || { joinTime: null, leaveTime: null, status: 'pending' };
        const status = record.status || 'pending';
        
        // ì¹´ìš´íŠ¸
        if (status === 'present') presentCount++;
        else if (status === 'late') lateCount++;
        else if (status === 'early-leave') earlyLeaveCount++;
        else if (status === 'absent') absentCount++;
        
        const statusLabel = {
          'present': 'ì¶œì„',
          'late': 'ì§€ê°',
          'early-leave': 'ì¡°í‡´',
          'absent': 'ê²°ì„',
          'pending': 'ë¯¸ì •'
        };
        
        return `
          <tr>
            <td>${index + 1}</td>
            <td>${name}</td>
            <td class="time-info">${record.joinTime ? formatTime(new Date(record.joinTime)) : '-'}</td>
            <td class="time-info">${record.leaveTime ? formatTime(new Date(record.leaveTime)) : '-'}</td>
            <td>
              <span class="attendance-status ${status}">${statusLabel[status]}</span>
            </td>
          </tr>
        `;
      }).join('');
      
      // ìš”ì•½ í‘œì‹œ
      document.getElementById('attendanceSummary').innerHTML = `
        <div class="summary-item">
          <span class="attendance-status present">ì¶œì„</span>
          <span class="count">${presentCount}ëª…</span>
        </div>
        <div class="summary-item">
          <span class="attendance-status late">ì§€ê°</span>
          <span class="count">${lateCount}ëª…</span>
        </div>
        <div class="summary-item">
          <span class="attendance-status early-leave">ì¡°í‡´</span>
          <span class="count">${earlyLeaveCount}ëª…</span>
        </div>
        <div class="summary-item">
          <span class="attendance-status absent">ê²°ì„</span>
          <span class="count">${absentCount}ëª…</span>
        </div>
        <div class="summary-item" style="margin-left:auto;">
          ì´ <span class="count">${attendanceData.students.length}ëª…</span>
        </div>
      `;
    }

    function exportAttendance() {
      const week = document.getElementById('weekSelect').value;
      const records = attendanceData.records[week] || {};
      
      let csv = 'ë²ˆí˜¸,ì´ë¦„,ì…ì¥ì‹œê°„,í‡´ì¥ì‹œê°„,ì¶œì„ìƒíƒœ\n';
      
      attendanceData.students.forEach((name, index) => {
        const record = records[name] || {};
        const statusLabel = {
          'present': 'ì¶œì„',
          'late': 'ì§€ê°',
          'early-leave': 'ì¡°í‡´',
          'absent': 'ê²°ì„',
          'pending': 'ë¯¸ì •'
        };
        
        csv += `${index + 1},${name},`;
        csv += `${record.joinTime ? formatTime(new Date(record.joinTime)) : '-'},`;
        csv += `${record.leaveTime ? formatTime(new Date(record.leaveTime)) : '-'},`;
        csv += `${statusLabel[record.status] || 'ë¯¸ì •'}\n`;
      });
      
      const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `ì¶œì„ë¶€_${currentUser.course}_${week}ì£¼ì°¨.csv`;
      link.click();
    }

    function formatTime(date) {
      if (!date) return '-';
      return date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }

    // ========== UI ì—…ë°ì´íŠ¸ (êµìˆ˜ ì»¨íŠ¸ë¡¤ í‘œì‹œ) ==========
    
    const originalUpdateMainUI = updateMainUI;
    updateMainUI = function() {
      originalUpdateMainUI();
      
      const isProfessor = currentUser.role === 'professor';
      const professorControls = document.getElementById('professorControls');
      
      if (isProfessor) {
        professorControls.classList.add('show');
        loadAttendanceData();
        updateClassUI();
      } else {
        professorControls.classList.remove('show');
        // í•™ìƒì¸ ê²½ìš° ìë™ ì¶œì„ ì²´í¬ (í•™ìƒ ì´ë¦„ì´ ìˆ˜ê°•ìƒ ëª©ë¡ì— ìˆëŠ” ê²½ìš°)
        checkStudentAttendance();
      }
    };

    // í•™ìƒ ìë™ ì¶œì„ ì²´í¬
    function checkStudentAttendance() {
      // ê°•ì˜ ë°ì´í„° ë¡œë“œ
      const storageKey = `attendance_${currentUser.course}`;
      const saved = localStorage.getItem(storageKey);
      
      if (saved) {
        const data = JSON.parse(saved);
        if (data.isClassActive && data.students.includes(currentUser.name)) {
          // í•™ìƒì´ ìˆ˜ê°•ìƒ ëª©ë¡ì— ìˆê³  ìˆ˜ì—…ì´ ì§„í–‰ ì¤‘ì´ë©´ ì…ì¥ ê¸°ë¡
          if (!data.records[data.currentWeek]) {
            data.records[data.currentWeek] = {};
          }
          if (!data.records[data.currentWeek][currentUser.name]) {
            data.records[data.currentWeek][currentUser.name] = {
              joinTime: null,
              leaveTime: null,
              status: 'absent'
            };
          }
          if (!data.records[data.currentWeek][currentUser.name].joinTime) {
            data.records[data.currentWeek][currentUser.name].joinTime = new Date().toISOString();
            localStorage.setItem(storageKey, JSON.stringify(data));
            console.log('ì¶œì„ ì²´í¬ë¨:', currentUser.name);
          }
        }
      }
    }

    // í•™ìƒ í‡´ì¥ ì‹œ ê¸°ë¡ (í˜ì´ì§€ ë– ë‚  ë•Œ)
    window.addEventListener('beforeunload', () => {
      if (currentUser.role === 'student') {
        const storageKey = `attendance_${currentUser.course}`;
        const saved = localStorage.getItem(storageKey);
        
        if (saved) {
          const data = JSON.parse(saved);
          if (data.isClassActive && data.records[data.currentWeek] && 
              data.records[data.currentWeek][currentUser.name]) {
            data.records[data.currentWeek][currentUser.name].leaveTime = new Date().toISOString();
            localStorage.setItem(storageKey, JSON.stringify(data));
          }
        }
      }
    });

    // ========== PWA ì„¤ì¹˜ ê¸°ëŠ¥ ==========
    let deferredPrompt = null;

    // Service Worker ë“±ë¡
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then((registration) => {
            console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
          })
          .catch((error) => {
            console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
          });
      });
    }

    // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì´ë²¤íŠ¸ ìº¡ì²˜ (Android/Chrome/Edge)
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ
      const installBtn = document.getElementById('installBtn');
      installBtn.classList.add('show');
    });

    // iOS ê°ì§€ ë° ê°€ì´ë“œ í‘œì‹œ
    function isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    }

    function isInStandaloneMode() {
      return window.matchMedia('(display-mode: standalone)').matches || 
             window.navigator.standalone === true;
    }

    // iOSì—ì„œ Safari ë¸Œë¼ìš°ì €ì¸ ê²½ìš° ê°€ì´ë“œ í‘œì‹œ
    if (isIOS() && !isInStandaloneMode()) {
      const iosGuide = document.getElementById('iosGuide');
      iosGuide.classList.add('show');
    }

    // ì•± ì„¤ì¹˜ í•¨ìˆ˜
    async function installApp() {
      if (!deferredPrompt) {
        alert('ì´ë¯¸ ì„¤ì¹˜ë˜ì—ˆê±°ë‚˜ ì„¤ì¹˜í•  ìˆ˜ ì—†ëŠ” í™˜ê²½ì…ë‹ˆë‹¤.');
        return;
      }

      // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
      deferredPrompt.prompt();
      
      const { outcome } = await deferredPrompt.userChoice;
      console.log('ì„¤ì¹˜ ê²°ê³¼:', outcome);
      
      if (outcome === 'accepted') {
        document.getElementById('installBtn').classList.remove('show');
      }
      
      deferredPrompt = null;
    }

    // ì„¤ì¹˜ ì™„ë£Œ ì´ë²¤íŠ¸
    window.addEventListener('appinstalled', () => {
      console.log('ì•±ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
      document.getElementById('installBtn').classList.remove('show');
      deferredPrompt = null;
    });
  </script>
</body>
</html>
